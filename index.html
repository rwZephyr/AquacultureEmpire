<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aquaculture Empire</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header id="topHeader">
    <div class="container">
    <!-- Top bar grouped for easier styling -->
    <div id="topBar">
      <div class="top-bar-group" id="siteGroup">
        <strong>Site:</strong>
        <div class="site-switcher">
          <button id="siteNameBtn" onclick="toggleSiteList()">
            <span id="siteName">-</span> ⌄
          </button>
          <div id="siteDropdownList" class="site-list hidden"></div>
        </div>
      </div>
      <div class="top-bar-group" id="statusGroup">
        <div><strong>Cash:</strong> $<span id="cashCount">0</span></div>
        <div>
          <strong>Date:</strong>
          <span id="dateDisplay">Spring 1, Year 1</span>
          <span id="pauseButton" class="time-btn" title="Pause" onclick="pauseTime()">⏸️</span>
          <span id="playButton" class="time-btn" title="Resume" onclick="resumeTime()">▶️</span>
        </div>
      </div>
      <div id="actionIconsWrapper">
        <div class="mobile-action-wrapper" id="siteActionGroup">
          <img id="siteActionToggle" src="assets/general-icons/siteactions.png" alt="Site Actions" class="icon-button" onclick="toggleSiteActions()" />
          <div id="siteActionMenu" class="hidden">
            <button onclick="buyNewSite()">+ New Site</button>
            <button onclick="openSiteManagement()">Manage Site</button>
          </div>
        </div>
        <div class="mobile-action-wrapper" id="toolsActionGroup">
          <img id="mobileActionToggle" src="assets/general-icons/browser.png" alt="Tools" class="icon-button" onclick="toggleMobileActions()" />
          <div id="mobileActionGroup" class="hidden">
            <button onclick="openMarketReport()">Market</button>
            <button id="shipyardBtn" onclick="openShipyard()">Shipyard</button><span id="shipyardLockReason" class="lock-reason"></span>
            <button onclick="openLogbook()" title="Open Logbook">Logbook</button>
            <button onclick="toggleDevTools()">⚙️</button>
          </div>
        </div>
        <div class="mobile-action-wrapper" id="bankActionGroup">
          <img id="bankActionToggle" src="assets/general-icons/bank.png"
               alt="Bank" class="icon-button" onclick="toggleBankActions()" />
          <div id="bankActionMenu" class="hidden">
            <button onclick="openBank()">Bank</button>
            <button onclick="openMarketReports()">Market Reports</button>
            <button disabled>Fiscal Data (WIP)</button>
          </div>
        </div>
      </div>
      <div id="quickStatusBar">
        <div id="feedStatusIcon" class="status-icon" onclick="toggleStatusPanel('feed')">
          <img src="assets/general-icons/bulkbag.png" alt="Feed">
          <div class="status-label">Feed</div>
          <div class="status-badge" id="feedStatusBadge">0/0kg</div>
        </div>
        <div id="bargeStatusIcon" class="status-icon" onclick="toggleStatusPanel('barge')">
          <img src="assets/general-icons/cagesystem.png" alt="Barge">
          <div class="status-label">Barge</div>
          <div class="status-badge" id="bargeStatusBadge"></div>
        </div>
        <div id="staffStatusIcon" class="status-icon" onclick="toggleStatusPanel('staff')">
          <img src="assets/general-icons/farmer.png" alt="Staff">
          <div class="status-label">Staff</div>
          <div class="status-badge" id="staffStatusBadge"></div>
        </div>
      </div>
    </div>
    </div>
  </header>

  <div id="feedPanel" class="status-panel">
    <h2>Feed Management</h2>
    <div class="progressBar"><div id="feedProgress" class="progress"></div></div>
    <div><span id="totalFeed">0</span> / <span id="totalFeedCapacity">0</span> kg</div>
    <div id="feedPurchaseSection" class="feed-purchase">
      <div class="feed-purchase-row">
        <input type="range" id="feedPurchaseSlider" min="0" value="0" step="1" oninput="syncFeedPurchase('slider')">
        <input type="number" id="feedPurchaseInput" min="0" value="0" step="1" oninput="syncFeedPurchase('input')">
      </div>
      <div id="feedPurchaseCost">Cost: $0.00</div>
      <div class="feed-purchase-buttons">
        <button onclick="confirmBuyFeed()">Buy</button>
        <button onclick="setFeedPurchaseMax()">Buy Max</button>
      </div>
    </div>
  </div>

  <div id="bargePanel" class="status-panel">
    <h2>Barge Management</h2>
    <div>
      <button class="staff-button" onclick="previousBarge()">⟵</button>
      Barge <span id="bargeIndex">1</span>/<span id="bargeCount">1</span>
      <button class="staff-button" onclick="nextBarge()">⟶</button>
    </div>
    <div>Feeders: <span id="bargeFeedersUsed">0</span>/<span id="bargeFeederLimit">0</span> (Max Tier <span id="bargeMaxFeederTier">0</span>)</div>
    <div>Feed: <span id="bargeFeed">0</span> / <span id="bargeFeedCapacity">0</span> kg</div>
    <div>Silo Capacity: <span id="bargeSiloCapacity">0</span> kg</div>
    <div>Staff: <span id="bargeStaffCount">0</span> / <span id="bargeStaffCapacity">0</span></div>
    <div>Unassigned: <span id="bargeStaffUnassigned">0</span></div>
    <div id="bargeHousingInfo"></div>
    <button class="staff-button" onclick="openBargeUpgradeModal()">Barge Upgrades</button>
  </div>

  <div id="staffPanel" class="status-panel">
    <h2>Staffing</h2>
    <div class="staff-stats">
      <div class="staff-info">
        <div>Total: <span id="staffTotal">0</span> / <span id="staffCapacity">0</span></div>
        <div>Unassigned: <span id="staffUnassigned">0</span></div>
      </div>
    </div>
    <div class="staff-buttons">
      <button class="staff-button" onclick="hireStaff()">&#x2795; Hire ($500)</button>
      <button class="staff-button" onclick="fireStaff()">&#x1f5d1; Fire</button>
    </div>
    <div class="staff-role">
      <span>Feeders:</span>
      <div class="role-controls">
        <button class="staff-button" onclick="unassignStaff('feeder')" aria-label="Remove feeder">&#x2212;</button>
        <span id="staffFeeders">0</span>
        <button class="staff-button" onclick="assignStaff('feeder')" aria-label="Add feeder">&#x2b;</button>
      </div>
    </div>
    <div class="staff-role">
      <span>Harvesters:</span>
      <div class="role-controls">
        <button class="staff-button" onclick="unassignStaff('harvester')" aria-label="Remove harvester">&#x2212;</button>
        <span id="staffHarvesters">0</span>
        <button class="staff-button" onclick="assignStaff('harvester')" aria-label="Add harvester">&#x2b;</button>
      </div>
    </div>
    <div class="staff-role">
      <span>Feed Managers:</span>
      <div class="role-controls">
        <button class="staff-button" onclick="unassignStaff('feedManager')" aria-label="Remove feed manager">&#x2212;</button>
        <span id="staffManagers">0</span>
        <button class="staff-button" onclick="assignStaff('feedManager')" aria-label="Add feed manager">&#x2b;</button>
      </div>
    </div>
  </div>

  <main id="mainLayout">
    <section id="pensSection">
     
    <!-- Pen grid -->
    <div id="penGrid">
      <h2>Pen Status</h2>
      <div id="newPenControls" class="newPenControls">
        <label for="newPenBargeSelect">Add Pen to Barge:</label>
        <select id="newPenBargeSelect" onchange="updateSelectedBargeDisplay()"></select>
        <button id="buyPenBtn" onclick="buyNewPen(document.getElementById('newPenBargeSelect').value)">+ Pen</button>
        <span id="selectedBargeDisplay"></span>
        <div id="penLockReason" class="lock-reason"></div>
      </div>
        <div id="penGridContainer" class="grid">
        </div>
      <template id="penCardTemplate">
        <div class="penCard">
          <h3 class="pen-name"></h3>
          <div class="stat">Species: <span class="pen-species"></span></div>
          <div class="stat">Fish: <span class="pen-fish"></span></div>
          <div class="stat">Avg Weight: <span class="pen-avg"></span> kg</div>
          <div class="stat">Biomass: <span class="pen-biomass"></span> kg</div>
          <div class="stat">Feeder: <span class="pen-feeder"></span></div>
          <div class="pen-warning"></div>
          <button class="feed-btn">Feed</button>
          <button class="restock-btn">Restock</button>
          <button class="upgrade-btn">Upgrade Feeder</button>
        </div>
      </template>
    </div>
    </section>
  </main>

  <footer id="bottomSection">
    <div class="container">
      <div id="vesselGridContainer" class="vesselGrid">
      </div>
        <template id="vesselCardTemplate">
          <div class="vesselCard compact">
            <div class="vessel-header">
              <div class="vessel-icon"></div>
              <h3 class="vessel-name"><span class="name-text"></span><span class="rename-icon" title="Rename">&#9998;</span></h3>
              <button class="actions-toggle" title="Actions">⚙</button>
              <div class="action-menu hidden">
                <button class="harvest-btn">Harvest</button>
                <button class="move-btn">Move</button>
                <button class="sell-btn">Sell</button>
                <button class="upgrade-btn">Upgrade</button>
                <button class="cancel-btn">Cancel</button>
              </div>
            </div>
            <div class="stat status-line">Status: <span class="vessel-status"></span></div>
            <div class="progressBar"><div class="progress vessel-progress"></div></div>
            <div class="stat load-line"><span class="vessel-load"></span> / <span class="vessel-capacity"></span> kg (<span class="load-percent"></span>%)</div>
            <div class="details-toggle">Details ⌄</div>
            <div class="vessel-details hidden">
              <div class="stat">Tier: <span class="vessel-tier"></span></div>
              <div class="stat">Location: <span class="vessel-location"></span></div>
              <div class="stat harvest-species"></div>
              <div class="stat fishbuffer-info"></div>
            </div>
          </div>
        </template>
    </div>
  </footer>

  <!-- Modals -->
    <div id="modal">
      <div id="modalContent">
        <p id="modalText"></p>
        <button onclick="closeModal()">OK</button>
      </div>
    </div>
    <div id="restockModal">
      <div id="restockModalContent">
        <h2>Choose Species</h2>
        <div id="restockOptions"></div>
        <div class="secondary-btn" onclick="closeRestockModal()">Cancel</div>
      </div>
    </div>
    <div id="harvestModal">
      <div id="harvestModalContent">
        <h2>Start Harvest</h2>
        <div>
          <label for="harvestPenSelect">Pen:</label>
          <select id="harvestPenSelect"></select>
        </div>
        <div>
          <label for="harvestHoldSelect">Hold:</label>
          <select id="harvestHoldSelect"></select>
          <span id="harvestHoldInfo"></span>
        </div>
        <div>Max: <span id="harvestMax">0</span> kg</div>
        <div class="harvest-input-row">
          <input type="number" id="harvestAmount" min="0" step="0.01">
          <span id="harvestFishCount"></span>
        </div>
        <input type="range" id="harvestSlider" min="0" step="0.01">
        <div class="harvest-max-buttons">
          <button id="harvestMaxHoldBtn" type="button">Max Hold</button>
          <button id="harvestMaxPenBtn" type="button">Max Pen</button>
        </div>
        <div id="harvestReason" class="harvest-reason"></div>
        <button id="harvestConfirmBtn" onclick="confirmHarvest()">Start Harvest</button>
        <button onclick="closeHarvestModal()">Cancel</button>
      </div>
    </div>
    <div id="sellModal">
      <div id="sellModalContent">
        <h2>Select Market</h2>
        <div>
          <label for="sellHoldSelect">Hold:</label>
          <select id="sellHoldSelect"></select>
          <span id="sellHoldInfo"></span>
        </div>
        <div id="sellOptions"></div>
        <button onclick="closeSellModal()">Cancel</button>
      </div>
    </div>
    <div id="moveModal">
      <div id="moveModalContent">
        <h2>Select Destination</h2>
        <div id="moveOptions"></div>
        <button onclick="closeMoveModal()">Cancel</button>
      </div>
    </div>
    <div id="renameModal">
      <div id="renameModalContent">
        <h2>Rename Vessel</h2>
        <input type="text" id="renameInput">
        <button onclick="confirmRename()">Rename</button>
        <button onclick="closeRenameModal()">Cancel</button>
      </div>
    </div>

    <div id="contractDeliveryModal">
      <div id="contractDeliveryContent">
        <h2>Select Vessel</h2>
        <div id="contractDeliveryOptions"></div>
        <button onclick="closeContractDeliveryModal()">Cancel</button>
      </div>
    </div>

    <div id="devModal">
      <div id="devModalContent">
        <h2>Developer Tools</h2>
        <h3>Cash &amp; Fish</h3>
        <button onclick="addDevCash()">Add $100k</button>
        <button onclick="devHarvestAll()">Harvest All Pens</button>
        <button onclick="devRestockAll()">Restock All (Free)</button>
        <button onclick="devAddBiomass()">+10kg Biomass (Pen)</button>

        <h3>Time Control</h3>
        <button onclick="devAdvanceTime(1)">+1 Day</button>
        <button onclick="devAdvanceTime(7)">+1 Week</button>
        <button onclick="devSetDatePrompt()">Set Date</button>
        <button onclick="devSetTimeScalePrompt()">Adjust Time Scale</button>

        <h3>Market Tools</h3>
        <button onclick="devResetMarketPrices()">Reset Market Prices</button>
        <button onclick="devRandomizeMarket()">Randomize Market</button>
        <button onclick="devSetMarketModifierPrompt()">Set Market Modifier</button>
        <button onclick="devInstantSellAll()">Instant Sell All Biomass</button>
        <h3>Settings</h3>
        <button id="onboardingToggleBtn" onclick="toggleOnboarding()">Onboarding: On</button>

        <h3>Utilities</h3>
        <button onclick="devRestartGame()">Restart Game</button>
        <button onclick="openSpeciesData()">Species Data</button>
        <button onclick="closeDevModal()">Close</button>
      </div>
    </div>

    <div id="speciesDataModal">
      <div id="speciesDataContent">
        <h2>Species Data</h2>
        <table id="speciesTable">
          <thead><tr><th>Name</th><th>FCR</th><th>Restock</th><th>Growth</th></tr></thead>
          <tbody></tbody>
        </table>
        <button onclick="closeSpeciesData()">Close</button>
      </div>
    </div>

    <div id="bankModal">
      <div id="bankModalContent">
        <button class="close-report-btn" onclick="closeBank()">Back</button>
        <h2>Bank</h2>
        <p>Deposit: $<span id="bankDepositDisplay">0.00</span> (2% daily interest)</p>
        <input id="bankDepositInput" type="number" min="0" />
        <button onclick="handleDeposit()">Deposit</button>

        <input id="bankWithdrawInput" type="number" min="0" />
        <button onclick="handleWithdraw()">Withdraw</button>

        <h3>Take a Loan</h3>
        <input id="loanAmountInput" type="number" min="0" />
        <button onclick="handleTakeLoan()">Take Loan</button>

        <h3>Active Loans</h3>
        <div id="loanList"></div>
      </div>
    </div>

    <div id="siteManagementModal">
      <div id="siteManagementContent">
        <button class="close-report-btn" onclick="closeSiteManagement()">Back</button>
        <h2>Site Management – <span id="siteManagementSiteName"></span></h2>
        <div id="siteLicenses"></div>
        <section id="licenseShop">
          <div class="site-switcher">
            <button id="licenseDropdownBtn" onclick="toggleLicenseList()">Buy License ⌄</button>
            <div id="licenseDropdownList" class="site-list hidden"></div>
          </div>
        </section>
        <h3>Site Upgrades</h3>
        <div id="siteUpgrades" class="site-upgrade-grid">
          <div class="site-upgrade-card">
            <h4>Dock Upgrade</h4>
            <p>Improves vessel turnaround speed.</p>
            <button data-upgrade="dockUpgrade" disabled>Work in Progress</button>
          </div>
          <div class="site-upgrade-card">
            <h4>Warehouse Expansion</h4>
            <p>Increases passive storage or barge feed storage.</p>
            <button data-upgrade="warehouseExpansion" disabled>Work in Progress</button>
          </div>
          <div class="site-upgrade-card">
            <h4>Environmental Sensors</h4>
            <p>Unlocks weather or seasonal UI in future.</p>
            <button data-upgrade="envSensors" disabled>Work in Progress</button>
          </div>
        </div>
      </div>
    </div>

    <div id="bargeUpgradeModal">
      <div id="bargeUpgradeModalContent">
        <h2>Barge Upgrades</h2>
        <div id="bargeUpgradeMessage" class="barge-alert" style="display:none"></div>
        <div id="upgradeSiloRow" class="upgrade-row"></div>
        <div id="upgradeBlowerRow" class="upgrade-row"></div>
        <div id="upgradeHousingRow" class="upgrade-row"></div>
        <button class="staff-button" onclick="closeBargeUpgradeModal()">Close</button>
      </div>
    </div>
    <div id="shipyardModal">
      <div id="shipyardModalContent">
        <button class="close-shipyard-btn" onclick="closeShipyard()">Back</button>
        <h2>Shipyard</h2>
        <div id="shipyardToggleButtons"></div>
        <div class="shipyard-panels">
          <div id="usedVesselsPanel">
            <h3>Used Vessels</h3>
            <div id="shipyardList" class="shipyard-list"></div>
            <button id="refreshListingsBtn" class="shipyard-main-btn" onclick="refreshShipyardListings()">Refresh Listings</button>
          </div>
          <div id="customBuildPanel" class="custom-build-page">
            <h3>Custom Build</h3>
            <div class="build-row">
              <label for="buildClassSelect">Class:</label>
              <span id="classIconPreview" class="build-icon"></span>
              <select id="buildClassSelect" onchange="updateCustomBuildStats()"></select>
            </div>
            <div id="buildStats"></div>
            <div class="build-row">
              <label for="buildNameInput">Name:</label>
              <input type="text" id="buildNameInput">
            </div>
            <div id="buildCostRow" class="shipyard-stat price"></div>
            <div id="buildLockMessage" class="lock-message" style="display:none"></div>
            <button onclick="confirmCustomBuild()">Purchase</button>
          </div>
        </div>
      </div>
    </div>
    <div id="logbookModal" class="logbook-modal">
      <button class="close-report-btn" onclick="closeLogbook()">Back</button>
      <div id="logbookContent" class="logbook-content">
        <h2>Logbook</h2>
        <div id="tabBar">
          <button id="tabMilestones" onclick="switchLogbookSection('milestones')">Milestones</button>
          <button id="tabSpecies" onclick="switchLogbookSection('species')">Species Info</button>
          <button id="tabContracts" onclick="switchLogbookSection('contracts')">Contracts</button>
          <button id="tabUpgrades" onclick="switchLogbookSection('upgrades')">Upgrades</button>
        </div>
        <div id="logbookMilestones">
          <div id="milestoneList"></div>
        </div>
        <div id="logbookSpecies" class="hidden">
          <div id="speciesInfoList"></div>
        </div>
        <div id="logbookContracts" class="hidden">
          <div id="contractsPlaceholder"></div>
        </div>
        <div id="logbookUpgrades" class="hidden">
          <div id="upgradesPlaceholder"></div>
        </div>
      </div>
    </div>
    <div id="marketReportPage" class="market-report-page">
      <button id="closeMarketReportBtn" class="close-report-btn" onclick="closeMarketReport()">Back</button>
      <!-- Market tables and future graph placeholder will be injected into this container -->
      <div id="marketReportContent" class="market-report"></div>
      </div>
    <div id="statusTooltip" class="status-tooltip" role="tooltip"></div>
    <div id="onboardingChecklist" class="onboarding-card hidden"></div>
    <div id="toastContainer"></div>
    <script src="data.js" defer></script>
    <script src="models.js" defer></script>
    <script src="gameState.js" defer></script>
    <script src="actions.js" defer></script>
    <script src="ui.js" defer></script>
    <script src="bank.js" defer></script>
    <script src="contracts.js" defer></script>
    <script src="milestones.js" defer></script>
  <script data-goatcounter="https://rwzephyr.goatcounter.com/count"
          async src="//gc.zgo.at/count.js"></script>
</body>
</html>
